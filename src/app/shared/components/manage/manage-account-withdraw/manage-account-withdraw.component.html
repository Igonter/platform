<app-dialog-wrapper title="Вывод средств из инвестиции" [modalRef]="modalRef">
  <form [formGroup]="form">
    <div class="text">
      <p>Я хочу:</p>

      <div class="radio-container">
        <input #withdrawRadio
               type="radio"
               name="withdrawType"
               id="withdraw-radio"
               value="withdraw"
               formControlName="withdrawType">
        <label for="withdraw-radio" class="radio-label">Вывести часть средств из инвестиции</label>
      </div>

      <div class="radio-hint">
        <div *ngIf="!account.strategy.isPaused()" class="negative">
          Частичное снятие возможно только в режиме
          <a class="pause-link" (click)="openStrategyPauseDialog()">Паузы</a>.
          Поставьте стратегию на паузу и повторите операцию.
        </div>
        <div *ngIf="account.strategy.isPaused() && !(form.get('withdrawType').value === 'withdraw')">
          Сумма, доступная для частичного вывода: {{account.availableToWithDraw | customCurrency}}.
        </div>
        <div class="form-field" *ngIf="account.strategy.isPaused() && form.get('withdrawType').value === 'withdraw'">
          <label for="amount" class="field-label">Сумма вывода, USD:</label>
          <div class="input-wrapper">
            <input id="amount"
                   type="number"
                   formControlName="amount"
                   [min]="0"
                   [max]="account.availableToWithDraw">
            <div class="messages">
              <label class="error-message"
                     *ngIf="form.get('amount').touched && form.get('amount').hasError('min')">
                Сумма вывода должна быть больше 0,01 USD.
              </label>
              <label class="error-message"
                     *ngIf="form.get('amount').touched && form.get('amount').hasError('max')">
                Указанное значение превышает доступную для вывода сумму.
              </label>
              <label class="error-message"
                     *ngIf="form.get('amount').touched && form.get('amount').hasError('required')">
                Укажите сумму вывода.
              </label>
              <label class="details-message">
                Баланс вашей инвестиции в вашу стратегию после вывода должен быть не меньше 200,00 USD.
              </label>
              <label class="details-message">
                Сумма, доступная для вывода: {{account.availableToWithDraw | customCurrency}}
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="radio-container">
        <input type="radio"
               name="withdrawType"
               id="close-radio"
               value="close"
               formControlName="withdrawType">
        <label for="close-radio" class="radio-label">Закрыть стратегию</label>
      </div>

      <div class="radio-hint">
        <div *ngIf="!(form.get('withdrawType').value === 'close')">
          Полное закрытие инвестиции в вашу собственную стратегию возможно только при ликвидации стратегии.
          Обратите внимание, что это необратимое действие.
        </div>
        <div *ngIf="(form.get('withdrawType').value === 'close')">
          <p>Вы можете закрыть вашу инвестицию в любой момент.
            Позже вы сможете создать новую инвестицию в ту же стратегию, при этом просадка инвестиции будет обнулена.</p>
          <div class="withdraw-amount">Текущая сумма средств: {{account.equity | customCurrency}}</div>
          <p>Средства вашей инвестиции рассчитаны по индикативным ценам.
            При закрытии инвестиции все открытые позиции будут закрыты по текущим рыночным ценам,
            которые могут незначительно отличаться от индикативных.</p>
        </div>

      </div>
    </div>

    <div class="dialog-actions">
      <button class="primary"
              *ngIf="form.get('withdrawType').value === 'withdraw'"
              (click)="withdraw()">
        Вывести
        <span *ngIf="form.get('amount').value > 0">({{form.get('amount').value | customCurrency}})</span>
      </button>

      <button class="warning"
              *ngIf="form.get('withdrawType').value === 'close'"
              (click)="close()">
        Закрыть стратегию
      </button>
    </div>
  </form>
</app-dialog-wrapper>
